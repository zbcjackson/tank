INFO:     Started server process [83573]
INFO:     Waiting for application startup.
2026-02-16 17:23:06,264 - ApiServer - INFO - API Server starting up
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     127.0.0.1:59506 - "WebSocket /ws/ggou0n" [accepted]
2026-02-16 17:23:59,845 - ApiRouter - INFO - WebSocket connected: ggou0n
2026-02-16 17:23:59,845 - src.voice_assistant.config.settings - INFO - Loaded environment variables from .env
2026-02-16 17:23:59,862 - ToolManager - INFO - Registered tool: get_weather
2026-02-16 17:23:59,862 - ToolManager - INFO - Registered tool: get_time
2026-02-16 17:23:59,862 - ToolManager - INFO - Registered tool: calculate
2026-02-16 17:23:59,862 - ToolManager - INFO - Registered tool: web_scraper
2026-02-16 17:23:59,862 - ToolManager - INFO - Registered tool: web_search
2026-02-16 17:24:00,216 - SherpaASR - INFO - SherpaASR initialized with model from models/sherpa-onnx-zipformer-en-zh
2026-02-16 17:24:00,216 - QueueSource - INFO - QueueAudioSource started
2026-02-16 17:24:00,216 - Speaker - INFO - TTSWorker started
2026-02-16 17:24:00,216 - CallbackSink - INFO - CallbackAudioSink started
2026-02-16 17:24:00,216 - SessionManager - INFO - Created and started assistant for session: ggou0n
2026-02-16 17:24:00,217 - ApiRouter - ERROR - WebSocket error in ggou0n: Cannot call "receive" once a disconnect message has been received.
Traceback (most recent call last):
  File "/Users/zbcjackson/src/tank/src/voice_assistant/api/router.py", line 100, in websocket_endpoint
    data = await websocket.receive()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/zbcjackson/src/tank/.venv/lib/python3.13/site-packages/starlette/websockets.py", line 57, in receive
    raise RuntimeError('Cannot call "receive" once a disconnect message has been received.')
RuntimeError: Cannot call "receive" once a disconnect message has been received.
2026-02-16 17:24:00,217 - QueueSource - INFO - QueueAudioSource joined
2026-02-16 17:24:00,321 - Speaker - INFO - TTSWorker stopped
2026-02-16 17:24:00,322 - CallbackSink - INFO - CallbackAudioSink joined
2026-02-16 17:24:00,322 - SessionManager - INFO - Closed session: ggou0n
INFO:     127.0.0.1:59508 - "WebSocket /ws/mb8u7d" [accepted]
2026-02-16 17:24:00,322 - ApiRouter - INFO - WebSocket connected: mb8u7d
2026-02-16 17:24:00,323 - src.voice_assistant.config.settings - INFO - Loaded environment variables from .env
2026-02-16 17:24:00,335 - ToolManager - INFO - Registered tool: get_weather
2026-02-16 17:24:00,335 - ToolManager - INFO - Registered tool: get_time
2026-02-16 17:24:00,335 - ToolManager - INFO - Registered tool: calculate
2026-02-16 17:24:00,335 - ToolManager - INFO - Registered tool: web_scraper
2026-02-16 17:24:00,335 - ToolManager - INFO - Registered tool: web_search
2026-02-16 17:24:00,659 - SherpaASR - INFO - SherpaASR initialized with model from models/sherpa-onnx-zipformer-en-zh
2026-02-16 17:24:00,659 - QueueSource - INFO - QueueAudioSource started
2026-02-16 17:24:00,659 - Speaker - INFO - TTSWorker started
2026-02-16 17:24:00,659 - CallbackSink - INFO - CallbackAudioSink started
2026-02-16 17:24:00,660 - SessionManager - INFO - Created and started assistant for session: mb8u7d
2026-02-16 17:24:06,213 - ApiRouter - INFO - Received message from mb8u7d: type=MessageType.INPUT, content=Hello, testing logs!
2026-02-16 17:24:06,213 - Brain - INFO - Brain processing started for input at 1771233846.214
2026-02-16 17:24:09,365 - httpx - INFO - HTTP Request: POST https://openrouter.ai/api/v1/chat/completions "HTTP/1.1 200 OK"
2026-02-16 17:24:10,955 - Speaker - INFO - TTSWorker: cleared interrupt_event at start of handle
2026-02-16 17:24:10,955 - Brain - INFO - Brain response finished at 1771233850.955, duration_s=4.741
2026-02-16 17:24:10,955 - Speaker - INFO - TTSWorker: got request content='Hey — Tank here. Logs received loud and clear. Wha' language=auto
2026-02-16 17:24:10,955 - Speaker - INFO - TTSWorker: starting generate_stream
2026-02-16 17:24:12,638 - Speaker - INFO - TTSWorker: stream done, put 230 chunks, sending end marker
2026-02-16 17:24:12,638 - Speaker - INFO - TTSWorker: handle finished for content='Hey — Tank here. Logs received loud and clear. Wha'
INFO:     Shutting down
2026-02-16 17:26:13,675 - ApiRouter - ERROR - WebSocket error in mb8u7d: Cannot call "receive" once a disconnect message has been received.
Traceback (most recent call last):
  File "/Users/zbcjackson/src/tank/src/voice_assistant/api/router.py", line 100, in websocket_endpoint
    data = await websocket.receive()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/zbcjackson/src/tank/.venv/lib/python3.13/site-packages/starlette/websockets.py", line 57, in receive
    raise RuntimeError('Cannot call "receive" once a disconnect message has been received.')
RuntimeError: Cannot call "receive" once a disconnect message has been received.
2026-02-16 17:26:13,676 - QueueSource - INFO - QueueAudioSource joined
2026-02-16 17:26:13,692 - Speaker - INFO - TTSWorker stopped
2026-02-16 17:26:13,760 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-12' coro=<<async_generator_athrow without __name__>()>>
/Users/zbcjackson/.local/share/uv/python/cpython-3.13.5-macos-aarch64-none/lib/python3.13/asyncio/base_events.py:750: RuntimeWarning: coroutine method 'aclose' of 'AsyncStream._iter_events' was never awaited
  self._ready.clear()
RuntimeWarning: Enable tracemalloc to get the object allocation traceback
2026-02-16 17:26:13,763 - CallbackSink - INFO - CallbackAudioSink joined
2026-02-16 17:26:13,763 - SessionManager - INFO - Closed session: mb8u7d
INFO:     Waiting for application shutdown.
2026-02-16 17:26:13,776 - ApiServer - INFO - API Server shutting down
INFO:     Application shutdown complete.
INFO:     Finished server process [83573]
